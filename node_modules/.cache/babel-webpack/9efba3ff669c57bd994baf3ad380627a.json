{"ast":null,"code":"import Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/photo/content.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"src/app/user/user.service\";\nimport * as i4 from \"@angular/common\";\n\nfunction DetailsComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"section\", 2);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Server Error -> \", ctx_r0.errorMessage, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"autohide in \", ctx_r0.time, \"\");\n  }\n}\n\nfunction DetailsComponent_ng_container_2_a_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 14);\n    i0.ɵɵlistener(\"click\", function DetailsComponent_ng_container_2_a_13_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return ctx_r5.delete();\n    });\n    i0.ɵɵtext(1, \"Delete\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst _c0 = function (a1) {\n  return [\"/edit\", a1];\n};\n\nfunction DetailsComponent_ng_container_2_a_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 15);\n    i0.ɵɵtext(1, \"Edit\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, ctx_r3.photo._id));\n  }\n}\n\nfunction DetailsComponent_ng_container_2_a_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 16);\n    i0.ɵɵlistener(\"click\", function DetailsComponent_ng_container_2_a_18_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.like();\n    });\n    i0.ɵɵtext(1, \"Like\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DetailsComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"section\", 3);\n    i0.ɵɵelementStart(2, \"h1\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 4);\n    i0.ɵɵelement(5, \"img\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"section\", 6);\n    i0.ɵɵelementStart(7, \"h3\");\n    i0.ɵɵtext(8, \"Photo Description\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 7);\n    i0.ɵɵelementStart(12, \"div\", 8);\n    i0.ɵɵtemplate(13, DetailsComponent_ng_container_2_a_13_Template, 2, 0, \"a\", 9);\n    i0.ɵɵtemplate(14, DetailsComponent_ng_container_2_a_14_Template, 2, 3, \"a\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 11);\n    i0.ɵɵelementStart(16, \"span\", 12);\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(18, DetailsComponent_ng_container_2_a_18_Template, 2, 0, \"a\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r1.photo.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r1.photo.imageUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.photo.description);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isOwner);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isOwner);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r1.photo.likes, \" likes\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.isOwner && !ctx_r1.isAlreadyLiked);\n  }\n}\n\nexport let DetailsComponent = /*#__PURE__*/(() => {\n  class DetailsComponent {\n    constructor(contentService, activatedRoutes, router, userService) {\n      this.contentService = contentService;\n      this.activatedRoutes = activatedRoutes;\n      this.router = router;\n      this.userService = userService;\n      this.errorMessage = '';\n      this.time = 5;\n      this.userInfo = this.userService.userInfo;\n      this.fetchPhoto();\n    }\n\n    get isOwner() {\n      var _a;\n\n      const userId = this.userInfo._id;\n      const photoOwnerId = (_a = this.photo) === null || _a === void 0 ? void 0 : _a.owner;\n\n      if (userId == photoOwnerId) {\n        return true;\n      }\n\n      return false;\n    }\n\n    fetchPhoto() {\n      this.photo = undefined;\n      const id = this.activatedRoutes.snapshot.params.id;\n      this.detailsSubscription = this.contentService.loadPhoto(id).subscribe({\n        next: photo => {\n          this.photo = photo;\n\n          if (this.photo.usersLiked.includes(this.userInfo._id)) {\n            this.isAlreadyLiked = true;\n          } else {\n            this.isAlreadyLiked = false;\n          }\n        },\n        error: error => {\n          this.errorMessage = error.error;\n          console.error('An error occure -> ', this.errorMessage);\n          this.time = 5;\n          const timer = setInterval(() => {\n            if (this.time <= 0) {\n              clearInterval(timer);\n            }\n\n            this.time--;\n\n            if (this.time == 0) {\n              this.errorMessage = '';\n            }\n          }, 1000);\n        }\n      });\n    }\n\n    like() {\n      var _a;\n\n      this.detailsSubscription.unsubscribe();\n      console.log('like test');\n      const photoId = (_a = this.photo) === null || _a === void 0 ? void 0 : _a._id;\n      const userId = this.userInfo._id;\n      this.likeSubscription = this.contentService.like(userId, photoId).subscribe({\n        next: photo => {\n          var _a;\n\n          this.photo = photo;\n          console.log(this.photo);\n\n          if ((_a = this.photo) === null || _a === void 0 ? void 0 : _a.usersLiked.includes(userId)) {\n            this.isAlreadyLiked = true;\n          } else {\n            this.isAlreadyLiked = false;\n          }\n        },\n        error: error => {\n          this.errorMessage = error.error;\n          console.error('An error occure -> ', this.errorMessage);\n          this.time = 5;\n          const timer = setInterval(() => {\n            if (this.time <= 0) {\n              clearInterval(timer);\n            }\n\n            this.time--;\n\n            if (this.time == 0) {\n              this.errorMessage = '';\n            }\n          }, 1000);\n        }\n      });\n    }\n\n    delete() {\n      var _a, _b;\n\n      const photoId = (_a = this.photo) === null || _a === void 0 ? void 0 : _a._id;\n      Swal.fire({\n        title: 'Are you sure?',\n        text: `${(_b = this.photo) === null || _b === void 0 ? void 0 : _b.title} will be permanently deleted!`,\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonText: 'Yes, delete it!',\n        cancelButtonText: 'No, keep it'\n      }).then(result => {\n        var _a, _b;\n\n        if (result.isConfirmed) {\n          this.contentService.delete(photoId).subscribe({\n            next: photo => {\n              this.photo = photo;\n              this.router.navigate(['/']);\n            },\n            error: error => {\n              this.errorMessage = error.error;\n              console.error('An error occure -> ', this.errorMessage);\n              this.time = 5;\n              const timer = setInterval(() => {\n                if (this.time <= 0) {\n                  clearInterval(timer);\n                }\n\n                this.time--;\n\n                if (this.time == 0) {\n                  this.errorMessage = '';\n                }\n              }, 1000);\n            }\n          });\n          Swal.fire('Deleted!', `${(_a = this.photo) === null || _a === void 0 ? void 0 : _a.title} has been deleted.`, 'success');\n          this.router.navigate(['/']);\n        } else if (result.dismiss === Swal.DismissReason.cancel) {\n          Swal.fire('Cancelled', `${(_b = this.photo) === null || _b === void 0 ? void 0 : _b.title} is safe :)`, 'error');\n        }\n      });\n    }\n\n  }\n\n  DetailsComponent.ɵfac = function DetailsComponent_Factory(t) {\n    return new (t || DetailsComponent)(i0.ɵɵdirectiveInject(i1.ContentService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.UserService));\n  };\n\n  DetailsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: DetailsComponent,\n    selectors: [[\"app-details\"]],\n    decls: 3,\n    vars: 2,\n    consts: [[4, \"ngIf\"], [1, \"container\"], [1, \"notifications\", \"error\"], [1, \"details\"], [2, \"text-align\", \"center\"], [3, \"src\"], [1, \"description\"], [1, \"info-buttons\"], [1, \"buttons-align\"], [\"class\", \"btn delete\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"btn edit\", 3, \"routerLink\", 4, \"ngIf\"], [1, \"likes-align\"], [1, \"likes\"], [\"class\", \"btn like\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"delete\", 3, \"click\"], [1, \"btn\", \"edit\", 3, \"routerLink\"], [1, \"btn\", \"like\", 3, \"click\"]],\n    template: function DetailsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, DetailsComponent_ng_container_0_Template, 6, 2, \"ng-container\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵtemplate(2, DetailsComponent_ng_container_2_Template, 19, 7, \"ng-container\", 0);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.errorMessage.length != 0);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.photo);\n      }\n    },\n    directives: [i4.NgIf, i2.RouterLinkWithHref],\n    styles: [\"a[_ngcontent-%COMP%]{text-decoration:none}.btn[_ngcontent-%COMP%]{border-radius:.3em;padding:.1em .3em;color:#000;box-shadow:2px 2px 5px rgba(0,0,0,.568)}.btn[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:rgba(0,0,0,.329);color:#fff}section[_ngcontent-%COMP%]{background-color:hsla(0,0%,100%,.849);margin:1em 3em;padding:1em;border-radius:1rem;box-shadow:2px 10px 1.5em 5px #000}section[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:2em}img[_ngcontent-%COMP%]{margin:0 auto;max-width:100%}.liked[_ngcontent-%COMP%]{background-color:green;padding:.5em;border-radius:.5em;color:#fff}a.create-photo[_ngcontent-%COMP%]{margin-left:2em;padding:.5em}.info-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.likes[_ngcontent-%COMP%]{display:block;margin:0 1em}.buttons-align[_ngcontent-%COMP%], .likes-align[_ngcontent-%COMP%]{display:flex}.edit[_ngcontent-%COMP%]{display:block;margin:0 1em}.errortext[_ngcontent-%COMP%]{background-color:initial;font-family:system-ui;font-size:1rem;color:#b90909}.notifications[_ngcontent-%COMP%]{margin:2em;padding:1em;position:absolute;right:0;width:20em;border:2px solid;border-image-slice:1;border-radius:1em;color:#fff}.error[_ngcontent-%COMP%]{background-color:rgba(245,58,136,.568);border-color:rgba(255,0,0,.315)}\"]\n  });\n  return DetailsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}